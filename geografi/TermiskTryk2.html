<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Termisk Lavtryk Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #e0f2fe; }
        canvas { display: block; }
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(0,0,0,0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="font-sans text-gray-800">

    <!-- Kontrolpanel -->
    <div class="control-panel fixed top-4 left-4 p-5 rounded-xl shadow-lg w-80 z-10">
        <h1 class="text-xl font-bold mb-2 text-slate-800">Termisk Lavtryk</h1>
        <p class="text-sm text-gray-600 mb-4">
            Tænd solen for at skabe opdrift. Tænd skyer for at se kondensering i højden.
        </p>

        <div class="flex flex-col gap-3">
            <!-- Sol Knap -->
            <button id="toggleSunBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-sm group">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <span id="btnText">Tænd Solen</span>
            </button>
            
            <!-- Skyer Knap -->
            <button id="toggleCloudBtn" class="w-full bg-slate-400 hover:bg-slate-500 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                </svg>
                <span id="cloudBtnText">Vis Regnskyer</span>
            </button>

            <button id="resetBtn" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors text-xs mt-2">
                Nulstil Simulation
            </button>
        </div>

        <!-- Forklaring / Legende -->
        <div class="mt-5 pt-4 border-t border-gray-200">
            <h3 class="text-xs font-bold text-gray-500 uppercase mb-2">Signaturforklaring</h3>
            <div class="flex items-center gap-2 mb-2">
                <div class="w-4 h-4 rounded-full bg-red-500 opacity-80 border border-red-600"></div>
                <span class="text-xs">Varm luft (Let, stiger op)</span>
            </div>
            <div class="flex items-center gap-2 mb-2">
                <div class="w-3 h-3 rounded-full bg-blue-600 opacity-80 border border-blue-700"></div>
                <span class="text-xs">Kold luft (Tung, falder ned)</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-8 h-4 bg-gray-300 rounded-full opacity-80"></div>
                <span class="text-xs">Skyer (Kondensering)</span>
            </div>
        </div>
        
        <div id="status" class="mt-4 p-2 bg-slate-50 rounded text-xs font-mono text-center text-gray-500 border border-slate-200">
            Status: Solen er slukket
        </div>
    </div>

    <canvas id="simCanvas"></canvas>

<script>
/**
 * Logik for Termisk Lavtryk Animation
 */

const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
const sunBtn = document.getElementById('toggleSunBtn');
const sunBtnText = document.getElementById('btnText');
const cloudBtn = document.getElementById('toggleCloudBtn');
const cloudBtnText = document.getElementById('cloudBtnText');
const resetBtn = document.getElementById('resetBtn');
const statusText = document.getElementById('status');

let width, height;
let sunActive = false;
let cloudsActive = false;
let particles = [];
let rainDrops = [];
const particleCount = 300; // Flere bobler for bedre effekt

// Fysik konstanter
const HEATING_RATE = 2.0;     
const COOLING_RATE = 0.6;     
const BUOYANCY_FORCE = 0.12;  
const GRAVITY = 0.06;         
const HORIZONTAL_FLOW = 0.2; 

const MIN_RADIUS = 3;
const MAX_RADIUS = 12;

function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
}

// Kald resize med det samme
resize();

// --- KLASSER ---

class Particle {
    constructor() {
        this.reset(true);
    }

    reset(randomizeAnywhere = false) {
        // Start position
        this.x = Math.random() * width;
        // Hvis randomizeAnywhere er sand, placeres de over hele skærmen (til start)
        // Ellers starter de ved jorden (når de "dør" eller resetter naturligt)
        this.y = randomizeAnywhere ? Math.random() * (height - 50) : height - 60;
        
        this.vx = (Math.random() - 0.5) * 1;
        this.vy = (Math.random() - 0.5) * 1;
        
        // Tilfældig start temperatur hvis vi starter forfra, ellers kold
        this.temp = randomizeAnywhere ? Math.random() * 30 : 0; 
        this.radius = MIN_RADIUS;
    }

    update() {
        // Zone definitioner
        const groundLevel = height - 50;
        const centerZone = Math.abs(this.x - width / 2) < width * 0.25;
        const nearGround = this.y > height * 0.65;
        const highAltitude = this.y < height * 0.35;

        // 1. Temperatur
        if (sunActive && centerZone && nearGround) {
            this.temp += HEATING_RATE;
        } else {
            let coolingFactor = 1;
            // Køles hurtigere højt oppe (især hvis skyer er aktive, symbolsk)
            if (highAltitude) coolingFactor = 1.8; 
            this.temp -= COOLING_RATE * coolingFactor;
        }
        this.temp = Math.max(0, Math.min(100, this.temp));

        // 2. Form (Charles' Lov)
        const targetRadius = MIN_RADIUS + (this.temp / 100) * (MAX_RADIUS - MIN_RADIUS);
        this.radius += (targetRadius - this.radius) * 0.1;

        // 3. Opdrift
        if (this.temp > 25) {
            // Varm luft stiger
            const lift = (this.temp / 100) * BUOYANCY_FORCE;
            this.vy -= lift; 
        } else {
            // Kold luft falder
            this.vy += GRAVITY;
        }

        // 4. Konvektion (Vind simulation)
        const centerX = width / 2;
        const distFromCenter = this.x - centerX;
        const isLeft = distFromCenter < 0;

        // Top: Divergens (Væk fra midten)
        if (this.y < height * 0.4) { 
            if (Math.abs(distFromCenter) < width * 0.45) {
                // Skub kraftigere ud hvis det er meget varmt
                const push = HORIZONTAL_FLOW * (1 + (this.temp/50));
                this.vx += isLeft ? -push : push;
            }
        } 
        // Bund: Konvergens (Ind mod midten) - Kun hvis sol er tændt (lavtrykket suger)
        else if (this.y > height * 0.75 && sunActive) {
            if (Math.abs(distFromCenter) > 20) {
                this.vx += isLeft ? HORIZONTAL_FLOW : -HORIZONTAL_FLOW;
            }
        }

        // Friktion
        this.vx *= 0.96;
        this.vy *= 0.96;

        // Position
        this.x += this.vx;
        this.y += this.vy;

        // Grænser
        if (this.y > height - 45 - this.radius) {
            this.y = height - 45 - this.radius;
            this.vy *= -0.5;
        }
        if (this.y < this.radius) {
            this.y = this.radius;
            this.vy *= -0.5;
        }
        if (this.x < this.radius) {
            this.x = this.radius;
            this.vx *= -0.8;
        }
        if (this.x > width - this.radius) {
            this.x = width - this.radius;
            this.vx *= -0.8;
        }
    }

    draw() {
        // Farve interpolation: Kold (Blå) -> Varm (Rød)
        // Bruger HSL for pænere overgang
        // Blå = 220deg, Rød = 0deg/360deg. Vi går fra 220 mod 0.
        // Men lad os bruge RGB for nemhed som før, bare finjusteret.
        
        let r, g, b;
        if (this.temp < 50) {
            // Blå til lilla/hvid
            const t = this.temp / 50;
            r = Math.floor(59 + t * (200 - 59));
            g = Math.floor(130 + t * (200 - 130));
            b = 246; 
        } else {
            // Hvid/Gul til Rød
            const t = (this.temp - 50) / 50;
            r = 255;
            g = Math.floor(200 - t * 200);
            b = Math.floor(246 - t * 246);
        }

        const alpha = 0.7;
        
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
        ctx.fill();
    }
}

class RainDrop {
    constructor() {
        this.reset();
    }
    
    reset() {
        // Regn falder primært fra midten hvor skyerne er
        this.x = (width / 2) + (Math.random() - 0.5) * (width * 0.5); 
        this.y = height * 0.3; // Starter ved skyhøjde
        this.speed = 4 + Math.random() * 4;
        this.length = 5 + Math.random() * 10;
        this.active = false;
    }

    update() {
        if (!cloudsActive) return;
        
        // Kun aktiver regn hvis vi er under skyerne (tjek sky-bredden ca)
        if (Math.abs(this.x - width/2) < width * 0.25) {
            this.active = true;
        } else {
            this.active = false;
        }

        if (this.active) {
            this.y += this.speed;
            if (this.y > height - 40) {
                this.reset();
            }
        }
    }

    draw() {
        if (!this.active || !cloudsActive) return;
        ctx.strokeStyle = "rgba(100, 150, 255, 0.6)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x, this.y + this.length);
        ctx.stroke();
    }
}

// --- INITIALISERING ---

function init() {
    resize(); // Sikrer korrekte dimensioner før particles laves
    particles = [];
    rainDrops = [];
    
    // Opret luftbobler
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }

    // Opret regndråber (pool)
    for (let i = 0; i < 100; i++) {
        rainDrops.push(new RainDrop());
    }
}

// Vent på load for at være sikker på window size
window.onload = init;
window.addEventListener('resize', () => {
    resize();
    // Vi re-initialiserer ikke på resize, da det resetter simulationen.
    // Vi lader bare boblerne finde deres vej inden for de nye rammer.
});

// --- TEGNING ---

function drawClouds() {
    if (!cloudsActive) return;

    const cloudBaseY = height * 0.3;
    const centerX = width / 2;
    
    // Tegn en samling af cirkler for at lave en sky
    // Skyen skal være bredere hvis sol er tændt (mere konvektion = større sky)
    const cloudWidth = sunActive ? 250 : 180;
    
    ctx.fillStyle = "rgba(240, 245, 255, 0.9)";
    ctx.shadowColor = "rgba(0,0,0,0.1)";
    ctx.shadowBlur = 15;
    
    // Tegn selve sky-formationen
    const time = Date.now() * 0.001;
    const puffCount = 8;
    
    for (let i = 0; i < puffCount; i++) {
        const offsetX = (i - puffCount/2) * (cloudWidth / puffCount) * 1.5;
        // Lidt bevægelse
        const moveX = Math.sin(time + i) * 10;
        
        ctx.beginPath();
        // Cirkler varierer i størrelse
        const r = 30 + Math.sin(i * 132) * 10 + (sunActive ? 10 : 0);
        
        // Lav skyen tykkere i midten
        const yOffset = Math.cos(i * 0.5) * 20;
        
        ctx.arc(centerX + offsetX + moveX, cloudBaseY - yOffset, r, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // Flad bund på skyen
    ctx.shadowBlur = 0;
    // (Valgfrit: Tegn en flad bund hvis man vil have "Cumulonimbus" look)
}

function drawBackground() {
    // Himmel Gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, height);
    
    if (cloudsActive && sunActive) {
        // Lidt mørkere himmel hvis der er regnskyer
        gradient.addColorStop(0, "#475569"); 
        gradient.addColorStop(1, "#94a3b8"); 
    } else {
        gradient.addColorStop(0, "#3b82f6"); 
        gradient.addColorStop(1, "#bae6fd"); 
    }
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, width, height);

    // Sol (kun hvis aktiv)
    if (sunActive) {
        const sunX = width / 2;
        const sunY = height * 0.1; // Solen er højere oppe end skyerne
        
        // Hvis skyer er aktive, gem solen lidt bag dem visuelt (mindre glød)
        const glowOpacity = cloudsActive ? 0.4 : 0.8;

        const glow = ctx.createRadialGradient(sunX, sunY, 20, sunX, sunY, 150);
        glow.addColorStop(0, `rgba(255, 200, 0, ${glowOpacity})`);
        glow.addColorStop(1, "rgba(255, 200, 0, 0)");
        ctx.fillStyle = glow;
        ctx.fillRect(0, 0, width, height);

        ctx.beginPath();
        ctx.arc(sunX, sunY, 40, 0, Math.PI * 2);
        ctx.fillStyle = "#fbbf24";
        // Mindre skygge hvis skyet
        ctx.shadowColor = cloudsActive ? "rgba(0,0,0,0)" : "#f59e0b";
        ctx.shadowBlur = cloudsActive ? 0 : 40;
        ctx.fill();
        ctx.shadowBlur = 0; 
    }

    // Jordoverflade
    ctx.fillStyle = "#15803d"; // Mørkere grøn
    ctx.fillRect(0, height - 40, width, 40);

    // Varm zone indikator
    if (sunActive) {
        const center = width / 2;
        const heatZone = ctx.createLinearGradient(center - 150, 0, center + 150, 0);
        heatZone.addColorStop(0, "rgba(255,50,0,0)");
        heatZone.addColorStop(0.5, "rgba(255,50,0,0.4)"); 
        heatZone.addColorStop(1, "rgba(255,50,0,0)");
        ctx.fillStyle = heatZone;
        ctx.fillRect(center - 200, height - 45, 400, 10);
    }
}

function animate() {
    ctx.clearRect(0, 0, width, height);
    
    drawBackground();

    // Pile
    if (sunActive) {
        ctx.strokeStyle = "rgba(0,0,0,0.15)";
        ctx.lineWidth = 2;
        // Pile ind mod midten ved bunden
        drawArrow(width * 0.2, height - 60, width * 0.3, height - 60);
        drawArrow(width * 0.8, height - 60, width * 0.7, height - 60);
        
        // Pile op
        drawArrow(width * 0.5, height - 150, width * 0.5, height * 0.5);

        // Pile ud i toppen (over skyerne hvis de er der)
        drawArrow(width * 0.45, height * 0.15, width * 0.3, height * 0.15);
        drawArrow(width * 0.55, height * 0.15, width * 0.7, height * 0.15);
    }

    // Tegn regn (bag skyerne, men foran baggrund)
    rainDrops.forEach(r => {
        r.update();
        r.draw();
    });

    // Tegn partikler
    particles.forEach(p => {
        p.update();
        p.draw();
    });

    // Tegn skyer (foran partikler for dybde, eller bagved? Foran ser bedst ud her)
    drawClouds();

    requestAnimationFrame(animate);
}

function drawArrow(fromx, fromy, tox, toy) {
    const headlen = 10; 
    const dx = tox - fromx;
    const dy = toy - fromy;
    const angle = Math.atan2(dy, dx);
    ctx.beginPath();
    ctx.moveTo(fromx, fromy);
    ctx.lineTo(tox, toy);
    ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
    ctx.moveTo(tox, toy);
    ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
    ctx.stroke();
}

// UI Event Listeners
sunBtn.addEventListener('click', () => {
    sunActive = !sunActive;
    if (sunActive) {
        sunBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
        sunBtn.classList.add('bg-orange-500', 'hover:bg-orange-600');
        sunBtnText.textContent = "Sluk Solen";
        statusText.textContent = "Status: Solen varmer jorden (Lavtryk)";
        statusText.classList.add("text-orange-600");
    } else {
        sunBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
        sunBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
        sunBtnText.textContent = "Tænd Solen";
        statusText.textContent = "Status: Solen er slukket";
        statusText.classList.remove("text-orange-600");
    }
});

cloudBtn.addEventListener('click', () => {
    cloudsActive = !cloudsActive;
    if (cloudsActive) {
        cloudBtn.classList.remove('bg-slate-400', 'hover:bg-slate-500');
        cloudBtn.classList.add('bg-slate-600', 'hover:bg-slate-700');
        cloudBtnText.textContent = "Skjul Regnskyer";
    } else {
        cloudBtn.classList.add('bg-slate-400', 'hover:bg-slate-500');
        cloudBtn.classList.remove('bg-slate-600', 'hover:bg-slate-700');
        cloudBtnText.textContent = "Vis Regnskyer";
    }
});

resetBtn.addEventListener('click', () => {
    init();
});

// Start loop
init();
animate();

</script>
</body>
</html>