<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jordklode Simulator (Lyst Design)</title>
    <style>
        /* Ændret baggrund til en lidt lysere mørkeblå, så kontrasten er pænere */
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background-color: #1a1a2e; color: white; }
        
        #ui-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9); /* Lyst panel nu */
            color: #333; /* Mørk tekst */
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ccc;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 { margin: 0 0 10px 0; font-size: 1.2rem; color: #0066cc; }
        .coord-box { margin-bottom: 5px; font-size: 1.1rem; }
        .label { font-weight: bold; color: #666; font-size: 0.9rem; }
        .value { color: #000; font-family: monospace; font-size: 1.2rem; font-weight: bold; }
        
        .legend { margin-top: 15px; font-size: 0.8rem; color: #444; }
        .dot { height: 10px; width: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #ccc;
            pointer-events: none;
            background: rgba(0,0,0,0.5);
            padding: 8px 0;
            font-size: 1.1rem;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="ui-panel">
        <h1>Geografiske Koordinater</h1>
        <div class="coord-box">
            <div class="label">Breddegrad (Latitude)</div>
            <div class="value" id="lat-display">0.00°</div>
        </div>
        <div class="coord-box">
            <div class="label">Længdegrad (Longitude)</div>
            <div class="value" id="lon-display">0.00°</div>
        </div>
        
        <div class="legend">
            <div><span class="dot" style="background:red;"></span>Ækvator (0° Bredde)</div>
            <div><span class="dot" style="background:#00ff00;"></span>Nul-meridian (0° Længde)</div>
            <div><span class="dot" style="background:#00ffff;"></span>Gitter (hver 30°)</div>
        </div>
    </div>

    <div id="instructions">Klik og træk for at rotere • Scroll for at zoome • Hold musen over for at se koordinater</div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Opsætning
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e); // Matcher CSS baggrunden

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 18;
        camera.position.y = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 6; // Tillader tættere zoom nu
        controls.maxDistance = 40;

        // 2. Jordkloden
        const radius = 5;
        const geometry = new THREE.SphereGeometry(radius, 64, 64);
        const textureLoader = new THREE.TextureLoader();
        
        const earthTextureUrl = 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Blue_Marble_2002.png/2048px-Blue_Marble_2002.png';
        
        textureLoader.load(earthTextureUrl, function (texture) {
             texture.colorSpace = THREE.SRGBColorSpace;
             
             const material = new THREE.MeshPhongMaterial({ 
                map: texture,
                shininess: 0, // Ingen genskin (plastik-effekt), så farverne står helt klare
                flatShading: false
            });
            
            const earth = new THREE.Mesh(geometry, material);
            earth.rotation.y = -Math.PI / 2; 
            scene.add(earth);
            
            addGridLines(); // Kalder funktionen der tegner linjerne
            animate();
        });

        // 3. LYS - HER ER DEN STORE ÆNDRING
        // Ambient Light (Baggrundslys) - Skruet helt op til 2.5 (Meget lyst)
        const ambientLight = new THREE.AmbientLight(0xffffff, 2.5); 
        scene.add(ambientLight);

        // Directional Light (Sollys) - For at give lidt dybde
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
        dirLight.position.set(5, 3, 5);
        scene.add(dirLight);

        // 4. Gitter-linjer (Funktion trukket ud for overblik)
        function addGridLines() {
            function createLineCircle(type, degree, color, width) {
                const lineGeom = new THREE.BufferGeometry();
                const points = [];
                const segments = 128;
                
                if (type === 'lat') { // Breddegrad
                    const r = radius * Math.cos(degree * (Math.PI / 180));
                    const y = radius * Math.sin(degree * (Math.PI / 180));
                    for (let i = 0; i <= segments; i++) {
                        const angle = (i / segments) * Math.PI * 2;
                        points.push(new THREE.Vector3(r * Math.cos(angle), y, r * Math.sin(angle)));
                    }
                } else { // Længdegrad
                    const rotation = degree * (Math.PI / 180);
                    for (let i = 0; i <= segments; i++) {
                        const angle = (i / segments) * Math.PI * 2;
                        const x = radius * Math.sin(angle) * Math.cos(rotation);
                        const y = radius * Math.cos(angle);
                        const z = radius * Math.sin(angle) * Math.sin(rotation);
                        points.push(new THREE.Vector3(x, y, z));
                    }
                }
                lineGeom.setFromPoints(points);
                // Lysere farver og mindre gennemsigtighed på linjerne
                const lineMat = new THREE.LineBasicMaterial({ color: color, transparent: false, linewidth: width });
                const line = new THREE.Line(lineGeom, lineMat);
                // Løft linjerne minimalt ud fra overfladen (0.01) så de ikke "glitcher" med kortet
                line.scale.set(1.002, 1.002, 1.002); 
                scene.add(line);
            }

            // Ækvator (Rød)
            createLineCircle('lat', 0, 0xff0000, 3);
            // Nul-meridian (Grøn)
            createLineCircle('lon', 0, 0x00ff00, 3);

            // Gitter (Cyan - meget lysere end før)
            const gridColor = 0x00ffff;
            for(let lat = -60; lat <= 60; lat+=30) {
                if(lat !== 0) createLineCircle('lat', lat, gridColor, 1);
            }
            for(let lon = 0; lon < 180; lon+=30) {
                if(lon !== 0) {
                    createLineCircle('lon', lon, gridColor, 1);
                    createLineCircle('lon', lon + 180, gridColor, 1);
                }
            }
        }

        // 5. Markør
        const marker = new THREE.Mesh(
            new THREE.SphereGeometry(0.12, 16, 16), 
            new THREE.MeshBasicMaterial({ color: 0xffff00 })
        );
        scene.add(marker);
        marker.visible = false;

        // 6. Raycasting
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const latDisplay = document.getElementById('lat-display');
        const lonDisplay = document.getElementById('lon-display');

        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            
            // Vi caster mod alle meshes, men filtrerer efter navnet eller bare tager den første
            const intersects = raycaster.intersectObjects(scene.children);
            
            // Find jordkloden (den største mesh)
            const hit = intersects.find(i => i.object.geometry.type === 'SphereGeometry' && i.object !== marker);

            if (hit) {
                const point = hit.point;
                marker.position.copy(point);
                marker.visible = true;

                const phi = Math.acos(point.y / radius);
                const theta = Math.atan2(point.z, point.x);

                let lat = 90 - (phi * (180 / Math.PI));
                let lon = (theta * (180 / Math.PI));
                
                lon = -lon; 
                if (lon > 180) lon -= 360;
                if (lon < -180) lon += 360;

                latDisplay.innerText = lat.toFixed(2) + "° " + (lat >= 0 ? "N" : "S");
                lonDisplay.innerText = Math.abs(lon.toFixed(2)) + "° " + (lon >= 0 ? "Ø" : "V");
            } else {
                marker.visible = false;
                latDisplay.innerText = "--";
                lonDisplay.innerText = "--";
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>