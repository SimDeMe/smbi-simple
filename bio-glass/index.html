<!doctype html>
<html lang="da">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bio-Glass | Biologisk Simulation</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <h1>Bio-Glass</h1>

            <nav class="nav-menu">
                <button id="btn-digestion" class="active" onclick="loadModule('digestion')">
                    1. Fordøjelse (C)
                </button>
                <button id="btn-kinetics" onclick="loadModule('kinetics')">
                    2. Enzymkinetik (B)
                </button>
                <button id="btn-glycolysis" onclick="loadModule('glycolysis')">
                    3. Glykolyse (A)
                </button>
            </nav>

            <!-- Dynamic Controls Panel -->
            <div id="controls-panel" class="controls-panel">
                <!-- Injected by modules -->
                <p>Vælg et modul.</p>
            </div>

            <div style="margin-top: auto;">
                <a href="../biologi.html" style="text-decoration:none; color:#666; font-size:0.8rem;">← Tilbage til
                    Biologi</a>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="main-view">
            <!-- The Glass Vessel -->
            <div id="canvas-container">
                <div id="overlay-info" class="module-info">
                    <h2 id="module-title">Velkommen</h2>
                    <p id="module-desc">Vælg en simulation til venstre for at starte.</p>
                </div>
            </div>

            <!-- Graph Overlay -->
            <div id="chart-container">
                <canvas id="data-chart"></canvas>
            </div>

        </main>
    </div>

    <!-- Engine & Modules -->
    <script src="js/engine.js"></script>

    <!-- Module scripts will be loaded dynamically or just included -->
    <script src="js/digestion.js"></script>
    <script src="js/kinetics.js"></script>
    <script src="js/glycolysis.js"></script>

    <script>
        // Main App Controller
        const bioEngine = new BioEngine('canvas-container');
        bioEngine.start();

        let currentModule = null;

        const modules = {
            digestion: {
                title: "Enzimatisk Nedbrydning",
                desc: "Amylase (gul) klipper stivelse. Pepsin (rød) klipper protein.",
                start: () => DigestionModule.init(bioEngine),
                stop: () => DigestionModule.teardown()
            },
            kinetics: {
                title: "Enzymkinetik",
                desc: "Undersøg hvordan Temperatur og pH påvirker reaktionshastigheden.",
                start: () => KineticsModule.init(bioEngine),
                stop: () => KineticsModule.teardown()
            },
            glycolysis: {
                title: "Glykolyse",
                desc: "Energi-investering og regulering af PFK-1 med ATP.",
                start: () => GlycolysisModule.init(bioEngine),
                stop: () => GlycolysisModule.teardown()
            }
        };

        function loadModule(moduleId) {
            // UI Updates
            document.querySelectorAll('.nav-menu button').forEach(b => b.classList.remove('active'));
            document.querySelector(`#btn-${moduleId}`).classList.add('active');

            document.getElementById('module-title').textContent = modules[moduleId].title;
            document.getElementById('module-desc').textContent = modules[moduleId].desc;

            // Stop previous
            if (currentModule && modules[currentModule].stop) {
                modules[currentModule].stop();
            }

            // Clear World
            bioEngine.clearWorld();
            document.getElementById('controls-panel').innerHTML = ''; // Clear controls
            document.getElementById('chart-container').style.display = 'none';

            // Start new
            currentModule = moduleId;
            if (modules[moduleId] && modules[moduleId].start) {
                modules[moduleId].start();
            }
        }

        // Initialize with Digestion
        window.onload = () => {
            // ensure scripts loaded
            setTimeout(() => loadModule('digestion'), 100);
        };

    </script>
</body>

</html>